<!-- WARNING! Magic happens here! -->
<script type="text/ng-template" id="docsFieldLevel">
	<docs-field field="field" container="container"></docs-field>

	<!-- When field is composite go into recursion -->
	<div ng-if="field.composite.length">
		<div>
			<strong>{{field.label}}</strong>

			<div class="pull-right display-block">
				<a href-void class="drag-handle">
					<i class="fa fa-fw fa-arrows text-muted" hover-class="text-primary"></i>
				</a>
				<a href-void ng-click="vm.deleteCompositeField(field)">
					<i class="fa fa-fw fa-trash-o text-muted" hover-class="text-danger"></i>
				</a>
			</div>
			<hr class="margin-top-5"/>
		</div>

		<!-- Nested gridster doesn't allow to drag and resize already defined elements -->
		<div gridster="vm.nestedGridsterOptions">
			<!-- ng-init:       Passes container of field -->
			<!-- ng-repeat:     Iterates over fields -->
			<!-- ng-style:      Ensure that order of items with position absolute is kept / selects issue -->
			<!-- gridster-item: Makes field draggable and resizable -->
			<!-- ng-class:      Composite class removes padding for nested containers -->
			<!-- ng-include:    Calls for recurrence invocation of script -->
			<div ng-init="container = field"
					 ng-repeat="field in field.composite track by $index"
					 ng-style="{'z-index': 800 + $index}"
					 ng-class="{'composite': field.composite.length}"
					 ng-include="'docsFieldLevel'"
					 gridster-item="field"></div>
		</div>
	</div>

</script>

<ul gridster class="margin-bottom-10">
	<!-- ng-repeat:     Iterates over fields -->
	<!-- ng-if:         Reduces amount of ng-repeat iterations -->
	<!-- ng-style:      Ensure that order of items with position absolute is kept / selects issue -->
	<!-- gridster-item: Makes field draggable and resizable -->
	<!-- ng-class:      Composite class removes padding for nested containers -->
	<!-- ng-include:    Calls for recurrence invocation of script -->
	<li ng-repeat="field in container.composite track by $index"
			ng-if="container.composite"
			ng-style="{'z-index': 500 - $index}"
			ng-class="{'composite': field.composite.length}"
			gridster-item="field"
			ng-include="'docsFieldLevel'">
	</li>
</ul>
